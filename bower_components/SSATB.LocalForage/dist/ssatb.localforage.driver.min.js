var localforageSsatbDriver={DRIVER_NAME:"localForage-SsatbDriver"};(function(){"use strict";function e(e){var r=this;return e&&(r._apiInfo=e.apiInfo),g.resolve()}function r(e,r){var n=null;if(null!=e)if(null!=r){var t=r.getAllResponseHeaders(),o=t.split("\n"),n={};for(var a in o){var i=o[a],u=i.split(":"),c=u[0];if(c&&(c=c.trim(),0!=c.length)){var l=u[1];l&&(l=l.trim()),n[c]=l}}}else console.warn("jqXHR is null. Headers not populated");return null!=n&&(e.responseHeaders=n),e}function n(e,r){var n=this,t=new g(function(r,t){n.ready().then(function(){var o=h(n._apiInfo);$.ajax({method:o.iterate.verb?o.iterate.verb:"GET",url:o.Url+o.iterate.url,headers:o.Headers,global:!1,cache:!1,dataType:"json",contentType:"application/json; charset=utf-8"}).done(function(n){for(var t=n.length,a=0;a<t;a++){var i=n[a];if(i=e(i,i[o.iterate.keyProperty],a+1),void 0!==i)return void r(i)}r()}).fail(function(e,r,n){t(d(o,e,r,n))})})["catch"](t)});return s(t,r),t}function t(e,n){var t=this,o=new g(function(n,o){t.ready().then(function(){var a=f(e),i=t._apiInfo[a.serviceName];$.ajax({method:a.verb,url:i.Url+a.url,dataType:"json",global:!1,cache:!1,contentType:"application/json; charset=utf-8",headers:i.Headers}).done(function(e,t,o){n(r(e,o))}).fail(function(e,r,n){o(d(a,e,r,n))})})["catch"](o)});return s(o,n),o}function o(e,n,t){var o=this,a=new g(function(t,a){o.ready().then(function(){var i=f(e),u=o._apiInfo[i.serviceName];$.ajax({method:i.verb,url:u.Url+i.url,dataType:"json",global:!1,cache:!1,contentType:"application/json; charset=utf-8",headers:u.Headers,data:JSON.stringify(n)}).done(function(e,o,a){n.response=e,t(r(n,a))}).fail(function(e,r,n){a(d(i,e,r,n))})})["catch"](a)});return s(a,t),a}function a(e,r){var n=this;"string"!=typeof e&&(window.console.warn(e+" used as a key, but it is not a string."),e=String(e));var t=new g(function(r,t){n.ready().then(function(){var o=f(e),a=n._apiInfo[o.serviceName];$.ajax({method:o.verb,url:a.Url+o.url,global:!1,cache:!1,headers:a.Headers}).done(function(){r()}).fail(function(e,r,n){t(d(o,e,r,n))})})["catch"](t)});return s(t,r),t}function i(e){var r=this,n=new g(function(e,n){r.ready().then(function(){})["catch"](n)});return s(n,e),n}function u(e){var r=this,n=new g(function(e,n){r.ready().then(function(){})["catch"](n)});return s(n,e),n}function c(e,r){var n=this,t=new g(function(e,r){n.ready().then(function(){})["catch"](r)});return s(t,r),t}function l(e){var r=this,n=new g(function(e,n){r.ready().then(function(){})["catch"](n)});return s(n,e),n}function s(e,r){r&&e.then(function(e){r(null,e)},function(e){r(e)})}function f(e){var r=e.split("|");return{serviceName:r[0],verb:r[1],url:r[2]}}function h(e){var r=null;for(var n in e){r=n;break}return null==r?null:e[r]}function d(e,r,n,t){return{serviceName:e.serviceName,method:e.verb,status:r.status,url:e.url,statusText:n,errorThrown:t,data:r.responseJSON}}var g="undefined"!=typeof module&&module.exports?require("promise"):this.Promise,v={DEFINE:1,EXPORT:2,WINDOW:3},p=v.WINDOW;"undefined"!=typeof module&&module.exports?p=v.EXPORT:"function"==typeof define&&define.amd&&(p=v.DEFINE);var m={_driver:localforageSsatbDriver.DRIVER_NAME,_initStorage:e,_support:!0,iterate:n,getItem:t,setItem:o,removeItem:a,clear:i,length:u,key:c,keys:l};p===v.DEFINE?define(localforageSsatbDriver.DRIVER_NAME,function(){return m}):p===v.EXPORT?module.exports=m:this[localforageSsatbDriver.DRIVER_NAME]=m,localforage.defineDriver(m)}).call(window),angular.module("SSATB.LocalForage",["LocalForageModule"]).provider("ssatbHttp",["$localForageProvider",function(e){function r(e){if(!angular.isObject(n.apiInfo))return null;var r=null;return angular.forEach(n.apiInfo,function(n,t){0===e.toLowerCase().indexOf(n.Url.toLowerCase())&&(r=t)}),r}var n={driver:[localforageSsatbDriver.DRIVER_NAME]};this.config=function(r){if(!angular.isObject(r))throw new Error("The config parameter should be an object");n=angular.extend(n,r),e.config(n)};var t=this.interceptors=[];this.$get=["$localForage","$q","$injector",function(e,o,a){function i(t){if(!angular.isObject(t))throw new Error("Http request configuration must be an object.");if(!angular.isString(t.url))throw new Error("Http request configuration url must be a string.");var a=angular.extend({method:"get"},t);a.method=angular.uppercase(a.method);var i=r(t.url);if(null===i)throw new Error("No matching apiInfo was found in the provider configuration for the service URL "+t.url);var u=[],c=[],f=o.when(a);return angular.forEach(s,function(e){(e.request||e.requestError)&&u.unshift(e.request,e.requestError),(e.response||e.responseError)&&c.push(e.response,e.responseError)}),f=l(f,u),f=f.then(function(r){var o=n.apiInfo[i],u=i+"|"+a.method+"|"+t.url.substring(o.Url.length);return"GET"===a.method?e.getItem(u):"DELETE"===a.method?e.removeItem(u):e.setItem(u,t.data)}),f=f.then(function(e){return null==e?{config:a}:(e.config=a,e)},function(e){throw null!=e?(e.config=a,e):new{config:a}}),l(f,c)}function u(e){angular.forEach(arguments,function(e){i[e]=function(r,n){return i(angular.extend({},n||{},{method:e,url:r}))}})}function c(e){angular.forEach(arguments,function(e){i[e]=function(r,n,t){return i(angular.extend({},t||{},{method:e,url:r,data:n}))}})}function l(e,r){for(var n=0,t=r.length;n<t;){var o=r[n++],a=r[n++];e=e.then(o,a)}return r.length=0,e}var s=[];return angular.forEach(t,function(e){s.unshift(angular.isString(e)?a.get(e):a.invoke(e))}),u("get","delete"),c("post","put"),i}]}]),function(){var e=function(e,r){function n(e,n){function t(e){return e}var o=e+"?serviceName="+n;return r.get(o).then(t)}return this.$window=e,this.$http=r,{refreshToken:n}},r=function(e,r){r.interceptors.push(["$q","$injector","$localForage",function(e,r,t){return{responseError:function(o){function a(e,r){if(null==r.serviceName)return null;var n=e[r.serviceName];return null==n?null:n.ServiceName}var i=e.defer(),u=t._localforage._apiInfo,c=a(u,o),l=r.get("ssatbAuthTokenRefreshConfig");return null==c||null==l.refreshTokenUrl||angular.isUndefined(o.config)||null==o.config||!angular.isUndefined(o.config.retry)&&0!=o.config.retry||401!==o.status?(angular.isUndefined(o.errorHandler)||null==l.errorHandler||l.errorHandler("An unexpected error occurred.  For assistance, please email info@enrollment.org."),i.reject(o)):r.get("authTokenRefreshService").refreshToken(l.refreshTokenUrl,c).then(function(e){var t=u[o.serviceName];t.Headers=e.data,n(o.config,i,r)},function(){angular.isUndefined(o.errorHandler)||null==l.errorHandler||l.errorHandler("An unexpected error occurred.  For assistance, please email info@enrollment.org."),i.reject(o)}),i.promise}}}])},n=function(e,r,n){$ssatbHttp=n.get("ssatbHttp"),e.retry=!0,$ssatbHttp(e).then(function(e){r.resolve(e)},function(e){alertDialog("An unexpected error occurred.  For assistance, please email info@enrollment.org."),r.reject(e)})};angular.module("ssatb.authtokenrefresh",["SSATB.LocalForage"]).provider("ssatbAuthTokenRefreshConfig",["ssatbHttpProvider",function(e){var r={};this.config=function(e){if(!angular.isObject(e))throw new Error("The config parameter should be an object");r=e},this.$get=function(){return r}}]).config(["$provide","ssatbHttpProvider",r]).service("authTokenRefreshService",["$window","$http",e])}();
//# sourceMappingURL=ssatb.localforage.driver.min.js.map
